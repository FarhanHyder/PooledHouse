{"ast":null,"code":"\"use strict\";\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) {\n      if (b.hasOwnProperty(p)) d[p] = b[p];\n    }\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar React = require(\"react\");\n\nvar react_1 = require(\"react\");\n\nvar core_1 = require(\"@aws-amplify/core\");\n\nvar storage_1 = require(\"@aws-amplify/storage\");\n\nvar AmplifyTheme_1 = require(\"../AmplifyTheme\");\n\nvar AmplifyUI_1 = require(\"../AmplifyUI\");\n\nvar PhotoPicker_1 = require(\"../Widget/PhotoPicker\");\n\nvar Common_1 = require(\"./Common\");\n\nvar logger = new core_1.ConsoleLogger('Storage.S3Image');\n\nvar S3Image =\n/** @class */\nfunction (_super) {\n  __extends(S3Image, _super);\n\n  function S3Image(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this._isMounted = false;\n    _this.handleOnLoad = _this.handleOnLoad.bind(_this);\n    _this.handleOnError = _this.handleOnError.bind(_this);\n    _this.handlePick = _this.handlePick.bind(_this);\n    _this.handleClick = _this.handleClick.bind(_this);\n    var initSrc = _this.props.src || AmplifyUI_1.transparent1X1;\n    _this.state = {\n      src: initSrc\n    };\n    return _this;\n  }\n\n  S3Image.prototype.getImageSource = function (key, level, track, identityId) {\n    var _this = this;\n\n    if (!storage_1.default || typeof storage_1.default.get !== 'function') {\n      throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n    }\n\n    storage_1.default.get(key, {\n      level: level ? level : 'public',\n      track: track,\n      identityId: identityId\n    }).then(function (url) {\n      if (_this._isMounted) {\n        _this.setState({\n          src: url\n        });\n      }\n    }).catch(function (err) {\n      return logger.debug(err);\n    });\n  };\n\n  S3Image.prototype.load = function () {\n    var _a = this.props,\n        imgKey = _a.imgKey,\n        path = _a.path,\n        body = _a.body,\n        contentType = _a.contentType,\n        level = _a.level,\n        track = _a.track,\n        identityId = _a.identityId;\n\n    if (!imgKey && !path) {\n      logger.debug('empty imgKey and path');\n      return;\n    }\n\n    var that = this;\n    var key = imgKey || path;\n    logger.debug('loading ' + key + '...');\n\n    if (body) {\n      var type = contentType || 'binary/octet-stream';\n\n      if (!storage_1.default || typeof storage_1.default.put !== 'function') {\n        throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n      }\n\n      var ret = storage_1.default.put(key, body, {\n        contentType: type,\n        level: level ? level : 'public',\n        track: track\n      });\n      ret.then(function (data) {\n        logger.debug(data);\n        that.getImageSource(key, level, track, identityId);\n      }).catch(function (err) {\n        return logger.debug(err);\n      });\n    } else {\n      that.getImageSource(key, level, track, identityId);\n    }\n  };\n\n  S3Image.prototype.handleOnLoad = function (evt) {\n    var onLoad = this.props.onLoad;\n\n    if (onLoad) {\n      onLoad(this.state.src);\n    }\n  };\n\n  S3Image.prototype.handleOnError = function (evt) {\n    var onError = this.props.onError;\n\n    if (onError) {\n      onError(this.state.src);\n    }\n  };\n\n  S3Image.prototype.handlePick = function (data) {\n    var that = this;\n    var path = this.props.path || '';\n    var _a = this.props,\n        imgKey = _a.imgKey,\n        level = _a.level,\n        fileToKey = _a.fileToKey,\n        track = _a.track,\n        identityId = _a.identityId;\n    var file = data.file,\n        name = data.name,\n        size = data.size,\n        type = data.type;\n    var key = imgKey || path + Common_1.calcKey(data, fileToKey);\n\n    if (!storage_1.default || typeof storage_1.default.put !== 'function') {\n      throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n    }\n\n    storage_1.default.put(key, file, {\n      level: level ? level : 'public',\n      contentType: type,\n      track: track\n    }).then(function (data) {\n      logger.debug('handle pick data', data);\n      that.getImageSource(key, level, track, identityId);\n    }).catch(function (err) {\n      return logger.debug('handle pick error', err);\n    });\n  };\n\n  S3Image.prototype.handleClick = function (evt) {\n    var onClick = this.props.onClick;\n\n    if (onClick) {\n      onClick(evt);\n    }\n  };\n\n  S3Image.prototype.componentDidMount = function () {\n    this._isMounted = true;\n    this.load();\n  };\n\n  S3Image.prototype.componentWillUnmount = function () {\n    this._isMounted = false;\n  };\n\n  S3Image.prototype.componentDidUpdate = function (prevProps) {\n    var update = prevProps.path !== this.props.path || prevProps.imgKey !== this.props.imgKey || prevProps.body !== this.props.body;\n\n    if (update) {\n      this.load();\n    }\n  };\n\n  S3Image.prototype.imageEl = function (src, theme) {\n    if (!src) {\n      return null;\n    }\n\n    var selected = this.props.selected;\n    var containerStyle = {\n      position: 'relative'\n    };\n    return React.createElement(\"div\", {\n      style: containerStyle,\n      onClick: this.handleClick\n    }, React.createElement(\"img\", {\n      style: theme.photoImg,\n      src: src,\n      onLoad: this.handleOnLoad,\n      onError: this.handleOnError\n    }), React.createElement(\"div\", {\n      style: selected ? theme.overlaySelected : theme.overlay\n    }));\n  };\n\n  S3Image.prototype.render = function () {\n    var _a = this.props,\n        hidden = _a.hidden,\n        style = _a.style,\n        picker = _a.picker,\n        translate = _a.translate,\n        imgKey = _a.imgKey;\n    var src = this.state.src;\n\n    if (translate) {\n      src = typeof translate === 'string' ? translate : translate({\n        type: 'image',\n        key: imgKey,\n        content: src\n      });\n    }\n\n    if (!src && !picker) {\n      return null;\n    }\n\n    var theme = this.props.theme || AmplifyTheme_1.default;\n    var photoStyle = hidden ? AmplifyTheme_1.default.hidden : Object.assign({}, theme.photo, style);\n    return React.createElement(\"div\", {\n      style: photoStyle\n    }, photoStyle ? this.imageEl(src, theme) : null, picker ? React.createElement(\"div\", null, React.createElement(PhotoPicker_1.default, {\n      key: \"picker\",\n      onPick: this.handlePick,\n      theme: theme\n    })) : null);\n  };\n\n  return S3Image;\n}(react_1.Component);\n\nexports.default = S3Image;","map":null,"metadata":{},"sourceType":"script"}