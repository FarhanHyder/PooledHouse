{"ast":null,"code":"\"use strict\";\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) {\n      if (b.hasOwnProperty(p)) d[p] = b[p];\n    }\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || Object.assign || function (t) {\n  for (var s, i = 1, n = arguments.length; i < n; i++) {\n    s = arguments[i];\n\n    for (var p in s) {\n      if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n  }\n\n  return t;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar React = require(\"react\");\n\nvar react_1 = require(\"react\");\n\nvar core_1 = require(\"@aws-amplify/core\");\n\nvar auth_1 = require(\"@aws-amplify/auth\");\n\nvar Amplify_UI_Theme_1 = require(\"../../Amplify-UI/Amplify-UI-Theme\");\n\nvar ui_1 = require(\"@aws-amplify/ui\");\n\nvar Amplify_UI_Components_React_1 = require(\"../../Amplify-UI/Amplify-UI-Components-React\");\n\nvar constants_1 = require(\"../common/constants\");\n\nvar logger = new core_1.ConsoleLogger('withFacebook');\n\nfunction withFacebook(Comp) {\n  return (\n    /** @class */\n    function (_super) {\n      __extends(class_1, _super);\n\n      function class_1(props) {\n        var _this = _super.call(this, props) || this;\n\n        _this.fbAsyncInit = _this.fbAsyncInit.bind(_this);\n        _this.initFB = _this.initFB.bind(_this);\n        _this.signIn = _this.signIn.bind(_this);\n        _this.signOut = _this.signOut.bind(_this);\n        _this.federatedSignIn = _this.federatedSignIn.bind(_this);\n        _this.state = {};\n        return _this;\n      }\n\n      class_1.prototype.signIn = function () {\n        var _this = this;\n\n        var fb = window.FB;\n        fb.getLoginStatus(function (response) {\n          var payload = {\n            provider: constants_1.default.FACEBOOK\n          };\n\n          try {\n            localStorage.setItem(constants_1.default.AUTH_SOURCE_KEY, JSON.stringify(payload));\n          } catch (e) {\n            logger.debug('Failed to cache auth source into localStorage', e);\n          }\n\n          if (response.status === 'connected') {\n            _this.federatedSignIn(response.authResponse);\n          } else {\n            fb.login(function (response) {\n              if (!response || !response.authResponse) {\n                return;\n              }\n\n              _this.federatedSignIn(response.authResponse);\n            }, {\n              scope: 'public_profile,email'\n            });\n          }\n        });\n      };\n\n      class_1.prototype.federatedSignIn = function (response) {\n        logger.debug(response);\n        var onStateChange = this.props.onStateChange;\n        var accessToken = response.accessToken,\n            expiresIn = response.expiresIn;\n        var date = new Date();\n        var expires_at = expiresIn * 1000 + date.getTime();\n\n        if (!accessToken) {\n          return;\n        }\n\n        var fb = window.FB;\n        fb.api('/me', {\n          fields: 'name,email'\n        }, function (response) {\n          var user = {\n            name: response.name,\n            email: response.email\n          };\n\n          if (!auth_1.default || typeof auth_1.default.federatedSignIn !== 'function' || typeof auth_1.default.currentAuthenticatedUser !== 'function') {\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n          }\n\n          auth_1.default.federatedSignIn('facebook', {\n            token: accessToken,\n            expires_at: expires_at\n          }, user).then(function (credentials) {\n            return auth_1.default.currentAuthenticatedUser();\n          }).then(function (authUser) {\n            if (onStateChange) {\n              onStateChange('signedIn', authUser);\n            }\n          });\n        });\n      };\n\n      class_1.prototype.signOut = function () {\n        var fb = window.FB;\n\n        if (!fb) {\n          logger.debug('FB sdk undefined');\n          return Promise.resolve();\n        }\n\n        fb.getLoginStatus(function (response) {\n          if (response.status === 'connected') {\n            return new Promise(function (res, rej) {\n              logger.debug('facebook signing out');\n              fb.logout(function (response) {\n                res(response);\n              });\n            });\n          } else {\n            return Promise.resolve();\n          }\n        });\n      };\n\n      class_1.prototype.componentDidMount = function () {\n        var facebook_app_id = this.props.facebook_app_id;\n        if (facebook_app_id && !window.FB) this.createScript();\n      };\n\n      class_1.prototype.fbAsyncInit = function () {\n        logger.debug('init FB');\n        var facebook_app_id = this.props.facebook_app_id;\n        var fb = window.FB;\n        fb.init({\n          appId: facebook_app_id,\n          cookie: true,\n          xfbml: true,\n          version: 'v2.11'\n        });\n        fb.getLoginStatus(function (response) {\n          return logger.debug(response);\n        });\n      };\n\n      class_1.prototype.initFB = function () {\n        var fb = window.FB;\n        logger.debug('FB inited');\n      };\n\n      class_1.prototype.createScript = function () {\n        window.fbAsyncInit = this.fbAsyncInit;\n        var script = document.createElement('script');\n        script.src = 'https://connect.facebook.net/en_US/sdk.js';\n        script.async = true;\n        script.onload = this.initFB;\n        document.body.appendChild(script);\n      };\n\n      class_1.prototype.render = function () {\n        var fb = window.FB;\n        return React.createElement(Comp, __assign({}, this.props, {\n          fb: fb,\n          facebookSignIn: this.signIn,\n          facebookSignOut: this.signOut\n        }));\n      };\n\n      return class_1;\n    }(react_1.Component)\n  );\n}\n\nexports.default = withFacebook;\n\nvar Button = function Button(props) {\n  return React.createElement(Amplify_UI_Components_React_1.SignInButton, {\n    id: ui_1.facebookSignInButton,\n    onClick: props.facebookSignIn,\n    theme: props.theme || Amplify_UI_Theme_1.default,\n    variant: 'facebookSignInButton'\n  }, React.createElement(Amplify_UI_Components_React_1.SignInButtonIcon, {\n    theme: props.theme || Amplify_UI_Theme_1.default\n  }, React.createElement(\"svg\", {\n    viewBox: '0 0 279 538',\n    xmlns: 'http://www.w3.org/2000/svg'\n  }, React.createElement(\"g\", {\n    id: 'Page-1',\n    fill: 'none',\n    fillRule: 'evenodd'\n  }, React.createElement(\"g\", {\n    id: 'Artboard',\n    fill: '#FFF'\n  }, React.createElement(\"path\", {\n    d: 'M82.3409742,538 L82.3409742,292.936652 L0,292.936652 L0,196.990154 L82.2410458,196.990154 L82.2410458,126.4295 C82.2410458,44.575144 132.205229,0 205.252865,0 C240.227794,0 270.306232,2.59855099 279,3.79788222 L279,89.2502322 L228.536175,89.2502322 C188.964542,89.2502322 181.270057,108.139699 181.270057,135.824262 L181.270057,196.89021 L276.202006,196.89021 L263.810888,292.836708 L181.16913,292.836708 L181.16913,538 L82.3409742,538 Z',\n    id: 'Fill-1'\n  }))))), React.createElement(Amplify_UI_Components_React_1.SignInButtonContent, {\n    theme: props.theme || Amplify_UI_Theme_1.default\n  }, core_1.I18n.get('Sign In with Facebook')));\n};\n\nexports.FacebookButton = withFacebook(Button);","map":null,"metadata":{},"sourceType":"script"}